<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ê´€ë¦¬ì Â· ë©˜í†  ì¶œì„/ì¼ì§€ ì‹œìŠ¤í…œ</title>
<style>
  *{box-sizing:border-box}
  body{margin:0;font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#f4f6f9;color:#111}
  header{background:#fff;border-bottom:1px solid #ddd;padding:16px;text-align:center;font-weight:800;letter-spacing:-.2px}
  nav{display:flex;flex-wrap:wrap;background:#fff;border-bottom:1px solid #ddd}
  main{max-width:980px;margin:0 auto;padding:16px}
  .card{background:#fff;border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .muted{color:#666;font-size:12px}
  label{display:block;font-size:13px;margin-top:10px;font-weight:700}
  input,textarea,select{width:100%;padding:10px;margin-top:6px;border:1px solid #cfd6e0;border-radius:10px;font-size:14px;background:#fff}
  textarea{min-height:96px;resize:vertical}
  .row{display:flex;gap:8px;align-items:flex-start}
  .row > *{flex:1;min-width:0}
  .chk{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
  .chk label{margin-top:0;font-weight:600}
  .btn{margin-top:14px;width:100%;padding:12px;border:none;border-radius:10px;font-size:14px;cursor:pointer}
  .btn.primary{background:#2f5bea;color:#fff;font-weight:800}
  .btn.ghost{background:#eef2ff;color:#2f5bea;font-weight:800}
  .btn-sm{padding:8px 10px;border-radius:9px;border:1px solid #d6dbe6;background:#fff;cursor:pointer;font-size:12px}
  .btn-sm.primary{background:#2f5bea;border-color:#2f5bea;color:#fff;font-weight:800}
  .btn-sm.danger{background:#ffecec;border-color:#ffd0d0;color:#b00020;font-weight:800}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  table.basic{width:100%;border-collapse:collapse;font-size:13px}
  table.basic th, table.basic td{border:1px solid #d6dbe6;padding:10px;vertical-align:top}
  table.basic th{background:#f7f9fc;text-align:center;white-space:nowrap}

  /* modals */
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:9999}
  .modal{background:#fff;border-radius:14px;width:min(1100px,100%);height:min(92vh,900px);display:flex;flex-direction:column;overflow:hidden}
  .modal-hd{padding:12px 14px;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .modal-hd b{font-size:14px}
  .modal-bd{flex:1;background:#fafafa}
  iframe{width:100%;height:100%;border:0;background:#fff}
  .modal-ft{padding:12px 14px;border-top:1px solid #eee;display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}

  @media print {
    nav, header, .no-print, .backdrop {display:none !important}
    body{background:#fff}
  }
/* ë©˜í‹° ì„ íƒ: ê³¼ëª© ì„ íƒ ì „ ë¹„í™œì„±í™” */
#menteeSection.disabled{opacity:.45;pointer-events:none}
#menteeGuide{display:none;margin:-6px 0 8px;color:#666;font-size:13px}

.isHidden{display:none!important}
.extra-guide{font-size:12px;color:#666;margin-top:6px}

.mentee-guide{
  margin-top:8px;
  font-size:13px;
  color:#666;
}


.mentee-title{
  margin-bottom:32px;
}


.mentee-guide{
  margin-top:32px;   /* ì œëª©ê³¼ ì„¤ëª… ì‚¬ì´ë¥¼ í™•ì‹¤íˆ ë¶„ë¦¬ */
  line-height:1.5;
}


/* âœ… ëª¨ë°”ì¼: (ê´€ë¦¬ì) ë©˜í‹° ì²´í¬ë¦¬ìŠ¤íŠ¸ í„°ì¹˜ ê°„ê²© ê°œì„  */
@media (max-width: 600px){
  #editMenteeChecklist label,
  #menteeChecklist label{
    display:flex;
    align-items:center;
    gap:10px;
    padding:12px 0;
    margin:0;
  }
  #editMenteeChecklist input[type="checkbox"],
  #menteeChecklist input[type="checkbox"]{
    transform: scale(1.2);
    transform-origin: left center;
  }
}

/* ê´€ë¦¬ì ì „ìš© ë¶€ë“œëŸ¬ìš´ ì•ˆë‚´ */
.admin-guide{
  margin-top: 6px;
  margin-bottom: 12px;
  padding: 14px 14px;
  border-radius: 14px;
  background: #f7f9ff;
  border: 1px solid #dbe3ff;
  color: #1c2f7a;
  font-size: 13px;
  line-height: 1.6;
}
.admin-guide b{font-weight: 800}
.admin-guide-link{
  font-weight: 700;
  color: #2f5bea;
  text-decoration: underline;
}

</style>
</head>
<body>
<header>ê´€ë¦¬ì Â· ë©˜í†  ì¶œì„/ì¼ì§€ ì‹œìŠ¤í…œ</header>

<nav class="no-print" aria-label="ì£¼ìš” ë©”ë‰´">
  <a class="btn-sm primary" href="index.html" style="margin:8px 12px; text-decoration:none; display:inline-flex; align-items:center;">â† ë©”ì¸ìœ¼ë¡œ</a>
</nav>

<main>
<!-- ê´€ë¦¬ì ë¡œê·¸ì¸ -->
<div class="card" id="loginCard">
  <div class="admin-guide">
    <b>ì•ˆë‚´</b><br/>
    ì´ í˜ì´ì§€ëŠ” ê´€ë¦¬ì ì „ìš©ì…ë‹ˆë‹¤.<br/>
    ì¼ë°˜ ë©˜í† ëŠ” ë©”ì¸ í˜ì´ì§€ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.
  </div>

  <label>ê´€ë¦¬ì ì´ë©”ì¼</label>
  <input id="adminEmail" type="email" placeholder="admin@email.com" />

  <label>ë¹„ë°€ë²ˆí˜¸</label>
  <input id="adminPw" type="password" />

  <button class="btn primary" id="btnLogin">ë¡œê·¸ì¸</button>
</div>

<!-- ê´€ë¦¬ì íŒ¨ë„ -->
<div class="card" id="adminPanel" style="display:none">
  <b>ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ</b>
  <p>ì´ì œ í†µê³„ / ì¡°íšŒ / ìˆ˜ì • / ì‚­ì œ ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥</p>
  <button class="btn" id="btnLogout">ë¡œê·¸ì•„ì›ƒ</button>
</div>

</main>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut }
  from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

/* ğŸ”¥ ë„¤ firebaseConfig ê·¸ëŒ€ë¡œ ìœ ì§€ */
const firebaseConfig = {
  apiKey: "ë„¤ê°’",
  authDomain: "ë„¤ê°’",
  projectId: "ë„¤ê°’"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
getFirestore(app);

// ë¡œê·¸ì¸
btnLogin.onclick = async () => {
  try{
    await signInWithEmailAndPassword(
      auth,
      adminEmail.value,
      adminPw.value
    );
  }catch(e){
    alert("ë¡œê·¸ì¸ ì‹¤íŒ¨");
  }
};

// ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€
onAuthStateChanged(auth, user => {
  if(user){
    loginCard.style.display = "none";
    adminPanel.style.display = "block";
  }else{
    loginCard.style.display = "block";
    adminPanel.style.display = "none";
  }
});

// ë¡œê·¸ì•„ì›ƒ
btnLogout.onclick = () => signOut(auth);
</script>
</body>
</html>
 
    <div class="card" id="adminPanel" style="display:none">
      <h3 style="margin:0 0 8px 0">ì¶œë ¥ ì˜µì…˜</h3>

      <div class="row">
        <div>
          <label for="optMentor">ë©˜í† ëª…</label>
          <input id="optMentor" list="mentorList" placeholder="ë©˜í† ëª… ì…ë ¥/ì„ íƒ (ë¹„ìš°ë©´ ì „ì²´)" />
          <datalist id="mentorList"></datalist>
        </div>
        <div>
          <label for="optField">ë¶„ì•¼</label>
          <select id="optField">
            <option value="ì „ì²´">ì „ì²´</option>
            <option value="ê³ ì¡¸">ê³ ì¡¸</option>
            <option value="ì¤‘ì¡¸">ì¤‘ì¡¸</option>
            <option value="ì´ˆì¡¸">ì´ˆì¡¸</option>
            <option value="ê¸°ì´ˆí•™ìŠµ">ê¸°ì´ˆí•™ìŠµ</option>
            <option value="ìƒì£¼ë©˜í† ë§">ìƒì£¼ë©˜í† ë§</option>
          </select>
        </div>
        <div>
          <label for="optSubject">ê³¼ëª©</label>
          <select id="optSubject">
            <option value="ì „ì²´">ì „ì²´</option>
            <option value="êµ­ì–´">êµ­ì–´</option>
            <option value="ì˜ì–´">ì˜ì–´</option>
            <option value="ìˆ˜í•™">ìˆ˜í•™</option>
            <option value="ì‚¬íšŒ">ì‚¬íšŒ</option>
            <option value="ê³¼í•™">ê³¼í•™</option>
            <option value="í•œêµ­ì‚¬">í•œêµ­ì‚¬</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn primary" id="btnSearchAdmin" type="button">ì¡°íšŒí•˜ê¸°</button>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn ghost" id="btnPreview" type="button">ë¯¸ë¦¬ë³´ê¸°</button>
        <button class="btn primary" id="btnPrintAll" type="button">ì¶œë ¥(ìƒˆ ì°½)</button>
      </div>

      <div class="muted" style="margin-top:10px">â€¢ ì¶œë ¥ì€ â€œìš”ì•½ 1í˜ì´ì§€ + ì„ íƒëœ ì¼ì§€ë“¤(í˜ì´ì§€ ìë™ ë¶„ë¦¬)â€ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</div>
    </div>

    <div class="card" id="adminListCard" style="display:none">
      <div class="row" style="align-items:center">
        <h3 style="margin:0">í™œë™ì¼ì§€ ëª©ë¡</h3>
        <div class="actions" style="justify-content:flex-end">
          <button class="btn-sm" id="btnRefreshAdmin" type="button">ìƒˆë¡œê³ ì¹¨</button>
          <button class="btn-sm danger" id="btnClearAll" type="button">ì „ì²´ ì‚­ì œ</button>
        </div>
      </div>

      <div style="margin-top:10px; overflow:auto">
        <table class="basic">
          <thead>
            <tr>
              <th>ë©˜í† </th>
              <th>í™œë™ì¼</th>
              <th>ìš”ì•½</th>
              <th>ë¯¸ë¦¬ë³´ê¸°/ì¶œë ¥</th>
            </tr>
          </thead>
          <tbody id="adminTable"></tbody>
        </table>
      </div>
    </div>

    <div class="card" id="adminStatsCard" style="display:none">
      <div class="muted" style="margin-top:0">â€» ì €ì¥ëœ í™œë™ì¼ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ ì§‘ê³„ë©ë‹ˆë‹¤. (ë©˜í‹°ëŠ” ì‰¼í‘œ/ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥ëœ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ 1íšŒê¸°ì”© ì¹´ìš´íŠ¸)</div>

      <div style="margin-top:12px; overflow:auto">
        <table class="basic">
          <tbody id="statsSummary"></tbody>
        </table>
      </div>

      <div style="margin-top:12px; overflow:auto">
        <h4 style="margin:0 0 6px 0">ë©˜í†  Â· ë¶„ì•¼ë³„ íšŒê¸°</h4>
        <table class="basic">
          <thead><tr><th>ë©˜í† </th><th>ë¶„ì•¼</th><th>íšŒê¸°</th><th>ëˆ„ì  ì‹œê°„</th></tr></thead>
          <tbody id="statsByMentor"></tbody>
        </table>
      </div>

      <div style="margin-top:12px; overflow:auto">
        <h4 style="margin:0 0 6px 0">ë©˜í‹°ë³„ ì¶œì„(íšŒê¸°)</h4>
        <table class="basic">
          <thead><tr><th>ë©˜í‹°</th><th>ì´ íšŒê¸°</th></tr></thead>
          <tbody id="statsByMentee"></tbody>
        </table>
      </div>

      <div style="margin-top:12px; overflow:auto">
        <h4 style="margin:0 0 6px 0">ë©˜í† -ë©˜í‹°ë³„ ì¶œì„(íšŒê¸°)</h4>
        <table class="basic">
          <thead><tr><th>ë©˜í† </th><th>ë©˜í‹°</th><th>íšŒê¸°</th></tr></thead>
          <tbody id="statsByPair"></tbody>
        </table>
      </div>
    </div>
  </section>
</main>

<!-- preview modal -->
<div class="backdrop" id="previewBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="ì¶œë ¥ ë¯¸ë¦¬ë³´ê¸°">
    <div class="modal-hd">
      <b>ì¶œë ¥ ë¯¸ë¦¬ë³´ê¸°</b>
      <button class="btn-sm" id="btnClosePreview" type="button">ë‹«ê¸°</button>
    </div>
    <div class="modal-bd">
      <iframe id="previewFrame" title="ë¯¸ë¦¬ë³´ê¸°"></iframe>
    </div>
    <div class="modal-ft">
      <button class="btn-sm primary" id="btnPrintFromPreview" type="button">ì´ëŒ€ë¡œ ì¶œë ¥</button>
    </div>
  </div>
</div>

<!-- edit modal -->
<div class="backdrop" id="editBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="ì¼ì§€ ìˆ˜ì •">
    <div class="modal-hd">
      <b>ì¼ì§€ ìˆ˜ì •</b>
      <button class="btn-sm" id="btnCloseEdit" type="button">ë‹«ê¸°</button>
    </div>
    <div class="modal-bd" style="background:#fff;overflow:auto">
      <div style="padding:14px">
        <div class="muted" id="editHint" style="margin-bottom:10px"></div>

        <label style="font-weight:700;font-size:13px">ë©˜í†  ì´ë¦„</label>
        <input id="editMentorName" />

        <label style="font-weight:700;font-size:13px">ë©˜í†  ìƒë…„ì›”ì¼(YYYY-MM-DD)</label>
        <input id="editMentorBirth" placeholder="ì˜ˆ) 2000-01-23" inputmode="numeric" />

        <label style="font-weight:700;font-size:13px">í™œë™ ë‚ ì§œ(YYYY-MM-DD)</label>
        <input id="editDate" placeholder="ì˜ˆ) 2025-05-11" inputmode="numeric" />

        <label style="font-weight:700;font-size:13px">ì‹œì‘ ì‹œê°„</label>
        <input id="editStart" placeholder="1530 ë˜ëŠ” 15:30" inputmode="numeric" />

        <label style="font-weight:700;font-size:13px">ì¢…ë£Œ ì‹œê°„</label>
        <input id="editEnd" placeholder="1730 ë˜ëŠ” 17:30" inputmode="numeric" />

        <label style="font-weight:700;font-size:13px">í™œë™ ì¥ì†Œ</label>
        <div class="row">
          <select id="editPlaceMode">
            <option value="">ì„ íƒ</option>
            <option value="ëŒ€ë©´">ëŒ€ë©´</option>
            <option value="ë¹„ëŒ€ë©´">ë¹„ëŒ€ë©´</option>
          </select>
          <select id="editPlaceDetail">
            <option value="">(ëŒ€ë©´ ì‹œ) ì¥ì†Œ ì„ íƒ</option>
            <option value="íƒ„íƒ„ëŒ€ë¡œì‹¤(3ì¸µ)">íƒ„íƒ„ëŒ€ë¡œì‹¤(3ì¸µ)</option>
            <option value="ë„ì„œê´€(3ì¸µ)">ë„ì„œê´€(3ì¸µ)</option>
            <option value="ìƒë‹´ì‹¤(3ì¸µ)">ìƒë‹´ì‹¤(3ì¸µ)</option>
            <option value="ìƒë‹´ì‹¤(2ì¸µ)">ìƒë‹´ì‹¤(2ì¸µ)</option>
            <option value="ë¼ì˜¨ì‹¤(B1ì¸µ)">ë¼ì˜¨ì‹¤(B1ì¸µ)</option>
          </select>
        <div id="editPlaceGuide" style="display:none;font-size:12px;color:#666;margin-top:6px">ë¹„ëŒ€ë©´ì€ ì¥ì†Œ ì„ íƒì´ í•„ìš” ì—†ì–´ìš”.</div>
        </div>

        <label style="font-weight:700;font-size:13px">í™œë™ ë¶„ì•¼</label>
        <select id="editField">
          <option value="">ì„ íƒ</option>
          <option value="ê³ ì¡¸">ê³ ì¡¸</option>
          <option value="ì¤‘ì¡¸">ì¤‘ì¡¸</option>
          <option value="ì´ˆì¡¸">ì´ˆì¡¸</option>
          <option value="ê¸°ì´ˆí•™ìŠµ">ê¸°ì´ˆí•™ìŠµ</option>
          <option value="ìƒì£¼ë©˜í† ë§">ìƒì£¼ë©˜í† ë§</option>
        </select>

        <label style="font-weight:700;font-size:13px">ê³¼ëª©</label>
        <select id="editSubject">
          <option value="">ì„ íƒ</option>
          <option value="êµ­ì–´">êµ­ì–´</option>
          <option value="ì˜ì–´">ì˜ì–´</option>
          <option value="ìˆ˜í•™">ìˆ˜í•™</option>
          <option value="ì‚¬íšŒ">ì‚¬íšŒ</option>
          <option value="ê³¼í•™">ê³¼í•™</option>
          <option value="í•œêµ­ì‚¬">í•œêµ­ì‚¬</option>
        </select>

        <label style="font-weight:700;font-size:13px">í™œë™ ë‚´ìš©</label>
        <textarea id="editContent" style="min-height:160px"></textarea>

        <label style="font-weight:700;font-size:13px">í™œë™ ì†Œê°</label>
        <textarea id="editReflection" style="min-height:100px"></textarea>

        <label style="font-weight:700;font-size:13px">ì˜¤ëŠ˜ì˜ í™œë™ ë§Œì¡±ë„(1~5)</label>
        <select id="editRating">
          <option value="0">ì„ íƒ ì•ˆ í•¨</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>

        <label style="font-weight:700;font-size:13px">ë©˜í‹° ì„ íƒ</label>
        <div class="row" style="gap:10px; align-items:center">
          <input id="editMenteeSearch" placeholder="ë©˜í‹° ê²€ìƒ‰ (ì´ë¦„ ì¼ë¶€)" style="flex:2" />
          <button class="btn-sm" id="btnEditMenteeAll" type="button">ì „ì²´ ì„ íƒ</button>
          <button class="btn-sm" id="btnEditMenteeClear" type="button">ì „ì²´ í•´ì œ</button>
        </div>
        <textarea id="editMentees" readonly style="min-height:80px" placeholder="ì•„ë˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ì—ì„œ ë©˜í‹°ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”."></textarea>
        <div id="editMenteeChecklist" class="chk" style="margin-top:10px;"></div>
        <div class="muted">* ì •í•´ì§„ ëª…ë‹¨ì—ì„œë§Œ ì„ íƒë©ë‹ˆë‹¤.</div>



        <label style="font-weight:700;font-size:13px">ìš”ì²­ì‚¬í•­</label>
        <textarea id="editRequest" style="min-height:100px"></textarea>

        <label style="font-weight:700;font-size:13px">ë‹¤ìŒ ë©˜í† ë§ ì¼ì •</label>
        <select id="editNext">
          <option value="">ì„ íƒ</option>
          <option value="ë³€ë™ ì—†ìŠµë‹ˆë‹¤">ë³€ë™ ì—†ìŠµë‹ˆë‹¤</option>
          <option value="ë³€ë™ í•„ìš”í•©ë‹ˆë‹¤">ë³€ë™ í•„ìš”í•©ë‹ˆë‹¤</option>
        </select>
      </div>
    </div>
    <div class="modal-ft">
      <button class="btn-sm danger" id="btnCancelEdit" type="button">ì·¨ì†Œ</button>
      <button class="btn-sm primary" id="btnSaveEdit" type="button">ì €ì¥</button>
    </div>
  </div>
</div>

<script>
(() => {
  'use strict';
  const $ = (id) => document.getElementById(id);
  // ---------- utils ----------
  function escapeHtml(s){
    return String(s ?? '').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]));
  }
  function normalizeTime(raw){
    const v = String(raw||'').trim();
    if (/^\d{4}$/.test(v)) return v.slice(0,2) + ':' + v.slice(2);
    if (/^\d{2}:\d{2}$/.test(v)) return v;
    if (/^\d{1,2}:\d{2}$/.test(v)) {
      const [h,m]=v.split(':');
      return String(h).padStart(2,'0')+':'+m;
    }
    return v;
  }
  function timeToMinutes(t){
    const v = normalizeTime(t);
    if(!/^\d{2}:\d{2}$/.test(v)) return null;
    const [h,m] = v.split(':').map(Number);
    if(Number.isNaN(h)||Number.isNaN(m)) return null;
    return h*60+m;
  }
  function calcTotal(start, end){
    const s = timeToMinutes(start);
    const e = timeToMinutes(end);
    if(s==null || e==null) return '';
    const diff = Math.max(0, e-s);
    const hh = Math.floor(diff/60);
    const mm = diff%60;
    return `${hh}ì‹œê°„ ${mm}ë¶„`;
  }
  function minutesBetween(start, end){
    const s = timeToMinutes(start);
    const e = timeToMinutes(end);
    if(s==null || e==null) return 0;
    return Math.max(0, e-s);
  }
  function minutesToText(mins){
    const hh = Math.floor(mins/60);
    const mm = mins%60;
    return `${hh}ì‹œê°„ ${mm}ë¶„`;
  }
  function parseMentees(text){
    const raw = String(text||'');
    const tokens = raw.split(/[\n,]/g).map(s => s.trim()).filter(Boolean);
    const seen = new Set();
    const out = [];
    for(const t of tokens){ if(!seen.has(t)){ seen.add(t); out.push(t); } }
    return out;
  }
  function stars(n){
    const k = Math.max(0, Math.min(5, parseInt(n||0,10) || 0));
    return 'â˜…â˜…â˜…â˜…â˜…'.slice(0,k) + 'â˜†â˜†â˜†â˜†â˜†'.slice(0,5-k);
  }
  function formatDateWithDay(dateStr){ return String(dateStr||'').replace(/-/g,'.'); }

  
  function formatDateWithDay(dateStr){
    if(!dateStr) return '';
    const parts = String(dateStr).split('-').map(Number);
    if(parts.length !== 3 || parts.some(n => Number.isNaN(n))) return String(dateStr);

    const [y, m, d] = parts;
    // âœ… ë¡œì»¬ ê¸°ì¤€ ë‚ ì§œ ìƒì„± (íƒ€ì„ì¡´/ë¸Œë¼ìš°ì € ì°¨ì´ë¡œ ìš”ì¼ í‹€ì–´ì§€ëŠ” ê²ƒ ë°©ì§€)
    const date = new Date(y, m - 1, d);

    const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
    const dow = days[date.getDay()];

    const mm = String(m).padStart(2,'0');
    const dd = String(d).padStart(2,'0');

    return `${y}.${mm}.${dd}(${dow})`;
  }
// ---------- output option ----------
  function getOutputOption(){
    const mentorRaw = ($('optMentor')?.value || '').trim();
    return {
      mentor: mentorRaw || 'ì „ì²´',
      field: ($('optField')?.value || 'ì „ì²´').trim() || 'ì „ì²´',
      subject: ($('optSubject')?.value || 'ì „ì²´').trim() || 'ì „ì²´'
    };
  }

  // ---------- data ----------
  function getLogs(){
  return window.__adminLogs || [];
}

  // =========================
  // ë©˜í‹° ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì •í•´ì§„ ëª…ë‹¨ë§Œ)
  // =========================
  const MENTEES = [
    // âœ… ì—¬ê¸°ë§Œ ë„¤ ë©˜í‹°ë¡œ ë°”ê¾¸ë©´ ë¼ìš”
  { name: "ì„ê²½í™˜", field: "ê³ ì¡¸", subject: "êµ­ì–´" },
  { name: "ì¡°ë¯¼í¬", field: "ê³ ì¡¸", subject: "êµ­ì–´" },
  { name: "ì •ì œí—Œ", field: "ê³ ì¡¸", subject: "êµ­ì–´" },
  { name: "í™ì£¼í˜„", field: "ê³ ì¡¸", subject: "êµ­ì–´" }, 
  { name: "ê¹€í˜•ì¤€", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ë°•ìˆ˜ë¹ˆ", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ë°•ì†Œë¯¼", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ì´í˜œì›", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ìœ ì§€ìˆ˜", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ì •íƒœì„±", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ì–‘ë¯¼ì² ", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ê¹€ì„œí¬", field: "ê¸°ì´ˆí•™ìŠµ", subject: "ìˆ˜í•™" },
  { name: "ê³ ì€ì‚¬ë‘", field: "ê³ ì¡¸", subject: "ìˆ˜í•™" },
  { name: "ì´ì‹œì€", field: "ê³ ì¡¸", subject: "ìˆ˜í•™" },
  { name: "ìœ¤ì—¬ìš´", field: "ê³ ì¡¸", subject: "ìˆ˜í•™" },
  { name: "í™ì£¼í˜„", field: "ê³ ì¡¸", subject: "ìˆ˜í•™" },  
  { name: "ê¹€í˜•ì¤€", field: "ê³ ì¡¸", subject: "ì˜ì–´" },
  { name: "ê¹€ì„œí¬", field: "ê³ ì¡¸", subject: "ì˜ì–´" },
  { name: "ì„œì˜ˆë ¹", field: "ê³ ì¡¸", subject: "ì˜ì–´" },
  { name: "ì¡°ë¯¼ìš°", field: "ê³ ì¡¸", subject: "ì˜ì–´" },
  { name: "ì •íƒœì„±", field: "ê³ ì¡¸", subject: "ì˜ì–´" },
  { name: "ì •ì œí—Œ", field: "ê³ ì¡¸", subject: "ì˜ì–´" },
  { name: "ê³ ìˆ˜ì§„", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ì‹ í˜„ì£¼", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ì´ì •ì›", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ìœ ì§€ìˆ˜", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ì„ê²½í™˜", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ìœ ì‹œì€", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ì¥ì€í˜¸", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ì¥í¬ì¬", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ì¡°ë¯¼í¬", field: "ê³ ì¡¸", subject: "í•œêµ­ì‚¬" },
  { name: "ê¹€ì˜ìš°", field: "ì¤‘ì¡¸", subject: "ìˆ˜í•™" },
  { name: "ê¹€ìˆ˜ì•„", field: "ì¤‘ì¡¸", subject: "ìˆ˜í•™" },
  { name: "ì†¡ì§€ì€", field: "ì¤‘ì¡¸", subject: "ìˆ˜í•™" },
  { name: "ìµœì‹œì–¸", field: "ì´ˆì¡¸", subject: "ìˆ˜í•™" } 
  ];

  function normalize(v){ return (v || '').trim(); }

  function filterMentees(field, subject){
    const f = normalize(field);
    const s = normalize(subject);
    return MENTEES.filter(m => {
      if(f && m.field !== f) return false;
      if(s && m.subject !== s) return false;
      return true;
    });
  }

  function uniqueNames(list){
    const seen = new Set();
    const out = [];
    for(const m of list){
      const n = m?.name;
      if(!n || seen.has(n)) continue;
      seen.add(n);
      out.push(n);
    }
    return out;
  }

  // âœ… ì „ì²´(ëª¨ë“  ê³¼ëª©/ë¶„ì•¼) 'ì •í•´ì§„ ë©˜í‹°' ì´ë¦„ Set (ì¶”ê°€ ì¸ì› íŒë³„ìš©)
  const ALL_PRESET_NAME_SET = new Set(uniqueNames(MENTEES));

  function getEditSearchQuery(){
    const q = $('editMenteeSearch')?.value || '';
    return q.trim();
  }

  function getAllowedMenteeSet(field, subject){
    const list = filterMentees(field, subject);
    return new Set(uniqueNames(list));
  }

  function renderEditMenteeChecklist(){
    const wrap = $('editMenteeChecklist');
    if(!wrap) return;

    const field = $('editField')?.value || "";
    const subject = ($('editField')?.value === 'ìƒì£¼ë©˜í† ë§') ? "" : ($('editSubject')?.value || "");
    const q = getEditSearchQuery();

    const names = Array.from(getAllowedMenteeSet(field, subject))
      .filter(n => !q || n.includes(q));

    if(!names.length){
      wrap.innerHTML = "<span class='muted'>ì¡°ê±´/ê²€ìƒ‰ì— ë§ëŠ” ë©˜í‹°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>";
      return;
    }

    const selected = new Set(parseMentees($('editMentees')?.value || ""));
    wrap.innerHTML = names.map(name => {
      const checked = selected.has(name) ? "checked" : "";
      return `<label><input type="checkbox" value="${name}" ${checked}> ${name}</label>`;
    }).join("");

    const syncPickedToTextarea = () => {
      const picked = Array.from(wrap.querySelectorAll('input[type="checkbox"]:checked')).map(x => x.value);
      $('editMentees').value = picked.join(', ');
    };

    wrap.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', syncPickedToTextarea);
    });
  }

  function setLogs(logs){
    window.__adminLogs = Array.isArray(logs) ? logs : [];
  }

  // ---------- mentor options (datalist) ----------
  function populateMentorOptions(){
    const logs = getLogs();
    const names = Array.from(new Set(logs.map(l => l?.mentor?.name).filter(Boolean))).sort((a,b)=>String(a).localeCompare(String(b),'ko'));
    const dl = $('mentorList');
    if(!dl) return;
    dl.innerHTML =
      '<option value="ì „ì²´"></option>' +
      names.map(n => `<option value="${escapeHtml(n)}"></option>`).join('');
  }

  // ---------- filtering ----------
  function filterLogs(allLogs, opt){
    return (allLogs||[]).filter(l => {
      if(opt.mentor && opt.mentor !== 'ì „ì²´' && (l.mentor?.name||'') !== opt.mentor) return false;
      if(opt.field && opt.field !== 'ì „ì²´' && (l.field||'') !== opt.field) return false;
      if(opt.subject && opt.subject !== 'ì „ì²´') {
        if((l.field||'') === 'ìƒì£¼ë©˜í† ë§') return false;
        if((l.subject||'') !== opt.subject) return false;
      }
      return true;
    });
  }
  function assignSessions(filtered){
    const logs = [...filtered].sort((a,b) => (a.date||'').localeCompare(b.date||''));
    const counts = new Map();
    return logs.map(l => {
      const mentorName = l.mentor?.name || '';
      const field = l.field || '';
      const subject = (field === 'ìƒì£¼ë©˜í† ë§') ? '' : (l.subject || '');
      const key = `${mentorName}|${field}|${subject}`;
      const next = (counts.get(key) || 0) + 1;
      counts.set(key, next);
      return Object.assign({}, l, { session: next });
    });
  }
  function getTotalTime(logs){
    let totalMin = 0;
    for(const l of (logs||[])) totalMin += minutesBetween(l.start, l.end);
    return minutesToText(totalMin);
  }

  // ---------- table ----------
  let currentFiltered = null; // last "ì¡°íšŒí•˜ê¸°" result

  function renderAdminTable(list){
    const logs = Array.isArray(list) ? list : getLogs();
    const tbody = $('adminTable');
    if(!tbody) return;

    if(!logs.length){
      tbody.innerHTML = `<tr><td colspan="4">ì €ì¥ëœ ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      return;
    }

    tbody.innerHTML = logs.map((l,i)=>({l,i}))
      .sort((a,b)=> (b.l.date||'').localeCompare(a.l.date||'') || (b.i-a.i))
      .map(({l,i}) => {
        const mentees = Array.isArray(l.mentees) ? l.mentees.join(', ') : '';
        const summary = `ë©˜í‹°: ${mentees}${l.field ? ' Â· ' + l.field : ''}${(l.field!=='ìƒì£¼ë©˜í† ë§' && l.subject) ? ' / ' + l.subject : ''}`;
        return `<tr>
          <td>${escapeHtml(l.mentor?.name||'')}</td>
          <td>${escapeHtml(formatDateWithDay(l.date||''))}</td>
          <td>${escapeHtml(summary)}</td>
          <td>
            <div class="actions">
              <button class="btn-sm" data-action="single" data-id="${l.id}">ë‹¨ì¼ ë¯¸ë¦¬ë³´ê¸°</button>
              <button class="btn-sm primary" data-action="singlePrint" data-id="${l.id}">ë‹¨ì¼ ì¶œë ¥</button>
              <button class="btn-sm" data-action="edit" data-id="${l.id}">ìˆ˜ì •</button>
              <button class="btn-sm danger" data-action="del" data-id="${l.id}">ì‚­ì œ</button>
            </div>
          </td>
        </tr>`;
      }).join('');
  }

  // ---------- stats ----------
  function renderStats(){
    const logs = getLogs();
    const sumEl = $('statsSummary');
    const byMentorEl = $('statsByMentor');
    const byMenteeEl = $('statsByMentee');
    const byPairEl = $('statsByPair');
    if(!sumEl || !byMentorEl || !byMenteeEl || !byPairEl) return;

    if(!logs.length){
      sumEl.innerHTML = `<tr><th>ìš”ì•½</th><td>ì €ì¥ëœ ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      byMentorEl.innerHTML = `<tr><td colspan="4">-</td></tr>`;
      byMenteeEl.innerHTML = `<tr><td colspan="2">-</td></tr>`;
      byPairEl.innerHTML = `<tr><td colspan="3">-</td></tr>`;
      return;
    }

    let totalMin = 0;
    for(const l of logs) totalMin += minutesBetween(l.start, l.end);

    const mentorFieldMap = new Map(); // mentor||field -> {mentor, field, sessions, minutes}
    const menteeMap = new Map(); // mentee -> sessions
    const pairMap = new Map();   // mentor||mentee -> sessions

    for(const l of logs){
      const mentor = l.mentor?.name || '';
      const mins = minutesBetween(l.start, l.end);

      if(mentor){
        const field = (l.field && String(l.field).trim()) ? String(l.field).trim() : 'ë¯¸ë¶„ë¥˜';
        const key = `${mentor}||${field}`;
        const cur = mentorFieldMap.get(key) || { mentor, field, sessions:0, minutes:0 };
        cur.sessions += 1;
        cur.minutes += mins;
        mentorFieldMap.set(key, cur);
      }

      const mentees = Array.isArray(l.mentees) ? l.mentees : [];
      for(const mm of mentees){
        const mentee = String(mm||'').trim();
        if(!mentee) continue;
        menteeMap.set(mentee, (menteeMap.get(mentee)||0) + 1);

        if(mentor){
          const key = `${mentor}||${mentee}`;
          pairMap.set(key, (pairMap.get(key)||0) + 1);
        }
      }
    }

    sumEl.innerHTML = `
      <tr><th style="width:35%">ì´ ì¼ì§€ ìˆ˜</th><td>${logs.length}ê±´</td></tr>
      <tr><th>ì´ í™œë™ íšŒê¸°</th><td>${logs.length}íšŒê¸°</td></tr>
      <tr><th>ì´ ëˆ„ì ì‹œê°„</th><td>${escapeHtml(minutesToText(totalMin))}</td></tr>
      <tr><th>ë©˜í†  ìˆ˜</th><td>${new Set(Array.from(mentorFieldMap.values()).map(v=>v.mentor)).size}ëª…</td></tr>
      <tr><th>ë©˜í‹° ìˆ˜</th><td>${menteeMap.size}ëª…</td></tr>
    `;

    const rows = Array.from(mentorFieldMap.values())
      .sort((a,b)=> b.sessions - a.sessions || a.mentor.localeCompare(b.mentor,'ko') || a.field.localeCompare(b.field,'ko'));

    byMentorEl.innerHTML = rows.map(r => `
      <tr>
        <td>${escapeHtml(r.mentor)}</td>
        <td>${escapeHtml(r.field)}</td>
        <td style="text-align:right">${r.sessions}íšŒê¸°</td>
        <td style="text-align:right">${escapeHtml(minutesToText(r.minutes))}</td>
      </tr>
    `).join('') || `<tr><td colspan="4">-</td></tr>`;

    const mentees = Array.from(menteeMap.entries()).sort((a,b)=> b[1]-a[1] || a[0].localeCompare(b[0],'ko'));
    byMenteeEl.innerHTML = mentees.map(([name, c]) => `
      <tr>
        <td>${escapeHtml(name)}</td>
        <td style="text-align:right">${c}íšŒê¸°</td>
      </tr>
    `).join('') || `<tr><td colspan="2">-</td></tr>`;

    const pairs = Array.from(pairMap.entries()).map(([k,c]) => {
      const [mentor, mentee] = k.split('||');
      return { mentor, mentee, c };
    }).sort((a,b)=> b.c-a.c || a.mentor.localeCompare(b.mentor,'ko') || a.mentee.localeCompare(b.mentee,'ko'));

    byPairEl.innerHTML = pairs.map(p => `
      <tr>
        <td>${escapeHtml(p.mentor)}</td>
        <td>${escapeHtml(p.mentee)}</td>
        <td style="text-align:right">${p.c}íšŒê¸°</td>
      </tr>
    `).join('') || `<tr><td colspan="3">-</td></tr>`;
  }

  // ---------- print html ----------
  function buildPrintHTML(allLogs, option){
    const opt = {
      mentor: (option.mentor || 'ì „ì²´').trim() || 'ì „ì²´',
      field: (option.field || 'ì „ì²´').trim() || 'ì „ì²´',
      subject: (option.subject || 'ì „ì²´').trim() || 'ì „ì²´'
    };

    const filtered = filterLogs(allLogs, opt);
    if(!filtered.length){
      return `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>ì¶œë ¥</title></head>
      <body style="font-family:'Noto Sans KR',sans-serif;padding:24px">
        <h3>ì¶œë ¥í•  ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ê´€ë¦¬ì ì¶œë ¥ ì˜µì…˜ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
      </body></html>
